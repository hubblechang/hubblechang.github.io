---
title: MySQL
categories: 
- MySQL
---
# 优化索引的方法
+ 前缀索引优化：使用某个字段中字符串的前几个字符建立索引。减小索引字段大小，可以增加一个索引页中存储的索引值，有效提高索引的查询速度。不过，order by 就无法使用前缀索引；无法把前缀索引用作覆盖索引；
+ 覆盖索引优化：建立联合索引，SQL 中 query 的所有字段，在索引 B+Tree 的叶子节点上都能找得到的那些索引，从二级索引中查询得到记录，而不需要通过聚簇索引查询获得，可以避免回表的操作。
+ 主键索引最好是自增的：插入一条新记录，都是追加操作，不需要重新移动数据。
如果使用非自增主键，由于每次插入主键的索引值都是随机的，因此每次插入新的数据时，就可能会插入到现有数据页中间的某个位置，这将不得不移动其它数据来满足新数据的插入，甚至需要从一个页面复制数据到另外一个页面，我们通常将这种情况称为页分裂。页分裂还有可能会造成大量的内存碎片，导致索引结构不紧凑，从而影响查询效率。
+ 防止索引失效：
    - 当我们使用左或者左右模糊匹配的时候，也就是 like %xx 或者 like %xx%这两种方式都会造成索引失效；
    - 当我们在查询条件中对索引列做了计算、函数、类型转换操作，这些情况下都会造成索引失效；
    - 联合索引要能正确使用需要遵循最左匹配原则，也就是按照最左优先的方式进行索引的匹配，否则就会导致索引失效。
    - 在 WHERE 子句中，如果在 OR 前的条件列是索引列，而在 OR 后的条件列不是索引列，那么索引会失效。

# explain
expain出来的信息有10列，分别是`id`、`select_type`、`table`、`type`、`possible_keys`、`key`、`key_len`、`ref`、`rows`、`Extra`,

{% asset_img explain字段.png Explain的字段 %}
其中，`type` 字段就是描述了找到所需数据时使用的扫描方式是什么，常见扫描类型的执行效率从低到高的顺序为：
+ All（全表扫描）；
+ index（全索引扫描）；
+ range（索引范围扫描）；
+ ref（非唯一索引扫描）；
+ eq_ref（唯一索引扫描）；
+ const（结果只有一条的主键或唯一索引扫描）。
尽量让 SQL 查询可以使用到 `range` 这一级别及以上的 `type` 访问方式

